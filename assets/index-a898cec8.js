import{r as e,d as t,f as n,a as r,a4 as s,a5 as o}from"./index-e8e769b7.js";function i(){const n=e.useRef(!1);return t((()=>(n.current=!0,()=>{n.current=!1})),[]),n}class c extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:t,isPresent:n}){const r=e.useId(),s=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect((()=>{const{width:e,height:t,top:i,left:c}=o.current;if(n||!s.current||!e||!t)return;s.current.dataset.motionPopId=r;const u=document.createElement("style");return document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${i}px !important;\n            left: ${c}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[n]),e.createElement(c,{isPresent:n,childRef:s,sizeRef:o},e.cloneElement(t,{ref:s}))}const a=({children:t,initial:n,isPresent:o,onExitComplete:i,custom:c,presenceAffectsLayout:a,mode:l})=>{const p=r(f),d=e.useId(),m=e.useMemo((()=>({id:d,initial:n,isPresent:o,custom:c,onExitComplete:e=>{p.set(e,!0);for(const t of p.values())if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))})),a?void 0:[o]);return e.useMemo((()=>{p.forEach(((e,t)=>p.set(t,!1)))}),[o]),e.useEffect((()=>{!o&&!p.size&&i&&i()}),[o]),"popLayout"===l&&(t=e.createElement(u,{isPresent:o},t)),e.createElement(s.Provider,{value:m},t)};function f(){return new Map}const l=e=>e.key||"";const p=({children:r,custom:s,initial:c=!0,onExitComplete:u,exitBeforeEnter:f,presenceAffectsLayout:p=!0,mode:d="sync"})=>{const m=e.useContext(o).forceRender||function(){const t=i(),[r,s]=e.useState(0),o=e.useCallback((()=>{t.current&&s(r+1)}),[r]);return[e.useCallback((()=>n.postRender(o)),[o]),r]}()[0],h=i(),E=function(t){const n=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&n.push(t)})),n}(r);let x=E;const y=e.useRef(new Map).current,R=e.useRef(x),P=e.useRef(new Map).current,g=e.useRef(!0);var C;if(t((()=>{g.current=!1,function(e,t){e.forEach((e=>{const n=l(e);t.set(n,e)}))}(E,P),R.current=x})),C=()=>{g.current=!0,P.clear(),y.clear()},e.useEffect((()=>()=>C()),[]),g.current)return e.createElement(e.Fragment,null,x.map((t=>e.createElement(a,{key:l(t),isPresent:!0,initial:!!c&&void 0,presenceAffectsLayout:p,mode:d},t))));x=[...x];const k=R.current.map(l),v=E.map(l),w=k.length;for(let e=0;e<w;e++){const t=k[e];-1!==v.indexOf(t)||y.has(t)||y.set(t,void 0)}return"wait"===d&&y.size&&(x=[]),y.forEach(((t,n)=>{if(-1!==v.indexOf(n))return;const r=P.get(n);if(!r)return;const o=k.indexOf(n);let i=t;if(!i){const t=()=>{y.delete(n);const e=Array.from(P.keys()).filter((e=>!v.includes(e)));if(e.forEach((e=>P.delete(e))),R.current=E.filter((t=>{const r=l(t);return r===n||e.includes(r)})),!y.size){if(!1===h.current)return;m(),u&&u()}};i=e.createElement(a,{key:l(r),isPresent:!1,onExitComplete:t,custom:s,presenceAffectsLayout:p,mode:d},r),y.set(n,i)}x.splice(o,0,i)})),x=x.map((t=>{const n=t.key;return y.has(n)?t:e.createElement(a,{key:l(t),isPresent:!0,presenceAffectsLayout:p,mode:d},t)})),e.createElement(e.Fragment,null,y.size?x:x.map((t=>e.cloneElement(t))))};export{p as A};
